
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - Optimized Lab Management System</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div class="dashboard-layout">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                 <a href="#" class="sidebar-header-link" id="dashboardHomeLink">
                    <i data-lucide="atom"></i>
                    <span class="sidebar-title">Optimized Lab Management</span>
                </a>
            </div>
            <ul class="sidebar-nav" id="sidebarNav">
                <!-- Nav items will be populated by JS -->
            </ul>
        </aside>
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <div class="main-content-wrapper">
            <header class="dashboard-header">
                <button type="button" class="mobile-menu-button" id="mobileMenuButton">
                    <i data-lucide="menu"></i>
                </button>
                <div class="user-nav" id="userNavContainer">
                    <!-- UserNav will be populated by JS -->
                </div>
            </header>
            <main class="page-content">
                <div class="custom-card">
                    <div class="custom-card-header">
                        <i data-lucide="user-circle"></i>
                        <h1 class="custom-card-title">User Profile</h1>
                    </div>
                    <div class="custom-card-content">
                        <p class="text-muted-foreground mb-6">
                            Manage your account details and preferences.
                        </p>
                        <form id="profileForm">
                            <div class="form-group">
                                <label for="fullName">Full Name</label>
                                <input type="text" id="fullName" name="fullName">
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" disabled>
                            </div>
                             <div class="form-group">
                                <label for="role">Role</label>
                                <input type="text" id="role" name="role" disabled>
                            </div>
                            <div class="form-group">
                                <label for="department">Department</label>
                                <select id="department" name="department">
                                    <option value="">Select your department</option>
                                    <!-- Options will be populated by JS from constants.js -->
                                </select>
                            </div>
                            <button type="submit" class="button button-primary">Update Profile</button>
                        </form>
                        <p id="profileMessage" class="mt-3" style="display:none; font-weight: 500;"></p>

                        <hr class="my-6" style="margin-top: 1.5rem; margin-bottom: 1.5rem; border-top: 1px solid #e5e7eb;">


                        <h2 class="text-xl font-semibold mb-3">Security Settings</h2>
                        <button type="button" id="changePasswordBtn" class="button button-outline">Change Password</button>
                        

                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="../js/constants.js"></script>
    <script src="../js/utils.js"></script>
    <script src="js/dashboard.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (!roleGuard([USER_ROLES.ADMIN, USER_ROLES.FACULTY, USER_ROLES.STUDENT, USER_ROLES.ASSISTANT])) return; // Added ASSISTANT
            
            initializeDashboard();
            setDashboardHomeLink();

            const fullNameInput = document.getElementById('fullName');
            const emailInput = document.getElementById('email');
            const roleInput = document.getElementById('role');
            const departmentSelect = document.getElementById('department');
            const profileForm = document.getElementById('profileForm');
            const changePasswordBtn = document.getElementById('changePasswordBtn');
            const profileMessage = document.getElementById('profileMessage');

            if(DEPARTMENTS && departmentSelect){
                DEPARTMENTS.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    departmentSelect.appendChild(option);
                });
            }
            
            const userName = localStorage.getItem('userName');
            const userEmail = localStorage.getItem('userEmail');
            const userRole = localStorage.getItem('userRole');
            const userDepartment = localStorage.getItem('userDepartment');

            if (fullNameInput && userName) fullNameInput.value = userName;
            if (emailInput && userEmail) emailInput.value = userEmail;
            if (roleInput && userRole) roleInput.value = userRole;
            if (departmentSelect && userDepartment) departmentSelect.value = userDepartment;

            if(profileForm) {
                profileForm.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const newFullName = fullNameInput.value;
                    const newDepartment = departmentSelect.value;

                    localStorage.setItem('userName', newFullName);
                    localStorage.setItem('userDepartment', newDepartment);
                    
                    if(profileMessage){
                        profileMessage.textContent = 'Profile updated successfully!';
                        profileMessage.style.color = 'green';
                        profileMessage.style.display = 'block';
                    }
                    
                    populateUserNav(userRole); 
                    if (window.lucide) window.lucide.createIcons(); 

                    setTimeout(() => { if(profileMessage) profileMessage.style.display = 'none'; }, 3000);
                });
            }

            if(changePasswordBtn){
                changePasswordBtn.addEventListener('click', () => {
                    alert('Change password functionality is not implemented in this demo.');
                });
            }

            if (window.lucide) window.lucide.createIcons();
        });
    </script>
</body>
</html>
